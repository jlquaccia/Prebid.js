<!--
  This page calls a single bidder for a single ad slot. It can be considered a "hello world" example for using
  Prebid with the Google Publisher Tag.
  It also makes a good test page for new adapter PR submissions. Simply set your server's Bid Params object in the
  bids array inside the adUnits, and it will use your adapter to load an ad.
  NOTE that many ad servers won't send back an ad if the URL is localhost... so you might need to
  set an alias in your /etc/hosts file so that you can load this page from a different domain.
-->

<html>
  <head>
    <script async src="../../build/dev/prebid.js"></script>
    <script
      async
      src="https://www.googletagservices.com/tag/js/gpt.js"
    ></script>
    <script>
      var FAILSAFE_TIMEOUT = 3300;
      var PREBID_TIMEOUT = 1000;

      var adUnits = [
        {
          // code: "gpt_unit_/6355419/Travel/Europe/France/Paris_0",
          code: "test",
          mediaTypes: {
            banner: {
              sizes: [[300, 250]],
            },
          },
          ortb2Imp: {
            instl: 1,
          },
          bids: [
            {
              bidder: "pubmatic",
              params: {
                publisherId: "156276",
                adSlot: "pubmatic_test"
              },
            }
          ],
        },
      ];

      var pbjs = pbjs || {};
      pbjs.que = pbjs.que || [];
    </script>

    <script>
      var googletag = googletag || {};
      googletag.cmd = googletag.cmd || [];

      googletag.cmd.push(function () {
        googletag.pubads().disableInitialLoad();
      });

      pbjs.que.push(function () {
        pbjs.addAdUnits(adUnits);
        pbjs.setConfig({
          interstitialVisibilityForBilling: {
            enabled: true
          }
        });
        pbjs.onEvent('billableEvent', billableBid => {
          console.log('billable event occurred', { billableBid });
        });
        pbjs.requestBids({
          bidsBackHandler: sendAdserverRequest,
          timeout: PREBID_TIMEOUT,
        });
      });

      function sendAdserverRequest() {
        if (pbjs.adserverRequestSent) return;
        pbjs.adserverRequestSent = true;
        googletag.cmd.push(function () {
          pbjs.que.push(function () {
            pbjs.setTargetingForGPTAsync();
            googletag.pubads().refresh();
          });
        });
      }

      setTimeout(function () {
        sendAdserverRequest();
      }, FAILSAFE_TIMEOUT);
    </script>

    <script>
      googletag.cmd.push(function () {
        // GPT ad slots
        var interstitialSlot;

        // Define a web interstitial ad slot.
        interstitialSlot = googletag.defineOutOfPageSlot("/6355419/Travel/Europe/France/Paris", googletag.enums.OutOfPageFormat.INTERSTITIAL);
        // Slot returns null if the page or device does not support interstitials.
        if (interstitialSlot) {
          interstitialSlot.addService(googletag.pubads());
          document.getElementById("status").innerText =
            "Interstitial is loading...";
        }

        googletag.defineSlot('/19968336/header-bid-tag-0', [[300, 250]], 'test').addService(googletag.pubads());

        // Enable SRA and services.
        googletag.pubads().enableSingleRequest();
        googletag.enableServices();
      });
    </script>
    <style>
      #link {
        display: none;
      }

      div.content {
        position: fixed;
        top: 50%;
      }
    </style>
  </head>

  <body>
    <h2>Prebid.js Test</h2>
    <h5>Div-1</h5>
    <div id='test'>
      <script type='text/javascript'>
          googletag.cmd.push(function() { googletag.display('test'); });
      </script>
    </div>
    <div class="content">
      <span id="status">Web interstitial is not supported on this page.</span>
      <p>
        <a id="link" href="https://www.example.com/">TRIGGER INTERSTITIAL</a>
      </p>
      <p>
        <!--
          You can prevent specific links from triggering GPT-managed web interstials by
          adding a data-google-interstitial="false" attribute to the anchor element or
          any ancestor of the anchor element.
        -->
        <a data-google-interstitial="false" href="https://www.example.com/">
          This link will never trigger an interstitial
        </a>
      </p>
    </div>
  </body>
</html>
