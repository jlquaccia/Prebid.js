<html>
<head>
<script>
    var PREBID_TIMEOUT = 3000;

    var googletag = googletag || {};
    googletag.cmd = googletag.cmd || [];

    function initAdserver() {
      if (pbjs.initAdserverSet) return;
      (function() {
          var gads = document.createElement('script');
          gads.async = true;
          gads.type = 'text/javascript';
          gads.src = 'https://securepubads.g.doubleclick.net/tag/js/gpt.js';
          var node = document.getElementsByTagName('script')[0];
          node.parentNode.insertBefore(gads, node);
        })();
      pbjs.initAdserverSet = true;
    };
    setTimeout(initAdserver, PREBID_TIMEOUT);

    var pbjs = pbjs || {};
    pbjs.que = pbjs.que || [];
    (function() {
        var pbjsEl = document.createElement("script");
        pbjsEl.type = "text/javascript";
        pbjsEl.async = true;
        pbjsEl.src = '/build/dev/prebid.js';
        var pbjsTargetEl = document.getElementsByTagName("head")[0];
        pbjsTargetEl.insertBefore(pbjsEl, pbjsTargetEl.firstChild);
      })();

    pbjs.que.push(function() {
        var adUnits= [
          {
            code: 'div-gpt-ad-1460505748561-0',
            mediaTypes: {
              banner: {
                sizes: [[728, 90]]
              } 
            },
            // floors: {
            //   currency: 'JPY',
            //   schema: {
            //     delimiter: '|',
            //     fields: [ 'mediaType', 'size' ]
            //   },
            //   values: {
            //     'banner|300x250': 1.10,
            //     'banner|*': 2.10,
            //     '*|*': 3.10
            //   }
            // },
            bids: [
              {
                bidder: 'appnexus',
                params: {
                   placementId: 13144370
                }
              },
              {
                bidder: 'pubmatic',
                params: {
                    publisherId: '156276',         // required
                    adSlot: 'pubmatic_test',       // required
                }
              },
              {
                bidder: 'rubicon',
                params: {
                  accountId: 14062,
                  siteId: 70608,
                  zoneId: 498816
                }
              }
            ]
          },
          {
            code: 'div-gpt-ad-1460505748561-1',
            mediaTypes: {
              banner: {
                sizes: [[300, 250]]
              } 
            },
            // floors: {
            //   currency: 'EUR',
            //   schema: {
            //     delimiter: '|',
            //     fields: [ 'mediaType', 'size' ]
            //   },
            //   values: {
            //     'banner|300x250': 0.10,
            //     'banner|*': 1.10,
            //     '*|*': 2.10
            //   }
            // },
            ortb2Imp: {
              ext: {
                prebid: {
                  floors: {
                    floorMinCur: 'USD',
                    floorMin: 1
                  }
                }
              }
            },
            bids: [
              {
                bidder: 'appnexus',
                params: {
                   placementId: 13144370
                }
              },
              {
                bidder: 'pubmatic',
                params: {
                    publisherId: '156276',         // required
                    adSlot: 'pubmatic_test',       // required
                }
              },
              {
                bidder: 'rubicon',
                params: {
                  accountId: 14062,
                  siteId: 70608,
                  zoneId: 498816
                }
              }
            ]
          }
        ];

        pbjs.setConfig({
          bidderTimeout: 3000,
          s2sConfig : {
            accountId : '1',
            enabled : true, //default value set to false
            defaultVendor: 'appnexus',
            bidders : ['appnexus', 'pubmatic', 'rubicon'],
            timeout : 1000, //default value is 1000
            adapter : 'prebidServer', //if we have any other s2s adapter, default value is s2s
            extPrebid: {
              floors: {
                enabled: true
              }
            }
          },
          floors: {
            // enforcement: {
            //   floorDeals: true,
            //   bidAdjustment: true
            // },
            data: {     // default if endpoint doesn't return in time
              currency: 'JPY',
              schema: {
                fields: ['mediaType', 'size']
              },
              values: {
                'banner|600x500': 6.5,
                '*|300x250': 3.3,
                '*|video': 3.5,
                'banner|*': 2,
              }
            }
          },
          // floors: {},
          "currency": {
            "adServerCurrency": "USD",
            "granularityMultiplier": 108,
            "defaultRates": {
              "USD": { "JPY": 144 }
            }
          },
          debug: true
        });

        pbjs.addAdUnits(adUnits);
        pbjs.requestBids({
            bidsBackHandler: function(bidResponses) {
                initAdserver();
            }
        })
    });
</script>

<script>
    googletag.cmd.push(function() {
        googletag.defineSlot('/19968336/header-bid-tag-0', [[728, 90]], 'div-gpt-ad-1460505748561-0').addService(googletag.pubads());
        googletag.defineSlot('/19968336/header-bid-tag-1', [[300, 250]], 'div-gpt-ad-1460505748561-1').addService(googletag.pubads());

        pbjs.que.push(function() {
            pbjs.setTargetingForGPTAsync();
        });

        googletag.pubads().enableSingleRequest();
        googletag.enableServices();
    });
    </script>
</head>

<body>
    <h2>Prebid.js S2S Example</h2>

    <h5>Div-1</h5>
    <div id='div-gpt-ad-1460505748561-0'>
      <script type='text/javascript'>
          googletag.cmd.push(function() { googletag.display('div-gpt-ad-1460505748561-0'); });
      </script>
    </div>
    <div id='div-gpt-ad-1460505748561-1'>
      <script type='text/javascript'>
        googletag.cmd.push(function() { googletag.display('div-gpt-ad-1460505748561-1'); });
      </script>
    </div>
</body>
</html>
